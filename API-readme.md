# API Documentation

This directory contains the API endpoints for the Trading AI Booster server. The API is built using Flask and provides access to accounts, trades, market data, and system diagnostics.

## üìö Table of Contents

- [Accounts](#accounts)
- [Symbols](#symbols)
- [Trades](#trades)
- [Candles](#candles)
- [Announcements](#announcements)
- [Trade Notes](#trade-notes)
- [Trading Signals](#trading-signals)
- [System Logs](#system-logs)
- [AI Responses](#ai-responses)
- [Statistics](#statistics)
- [Telegram](#telegram)

---

## <a name="accounts"></a> üè¶ Accounts

Manage trading accounts and retrieve account information.

### `GET /accounts`
Retrieve a list of all registered trading accounts.
- **Response:** Array of account objects (id, account_number, broker).

### `GET /account`
Retrieve detailed information for a specific account.
- **Query Params:**
  - `account_number` (Optional): Filter by account number. If not provided, returns the first found account.
- **Response:** Detailed account object (balance, equity, margin, free_margin, etc.).

### `POST /accounts/update`
Update or create account information (typically called from MT5/MQ5).
- **Body:**
  - `account_number` (Required): string
  - `balance`: float
  - `equity`: float
  - `margin`: float
  - `free_margin`: float
  - `margin_level`: float
  - `leverage`: int
  - `server`: string
  - `broker`: string
  - `currency`: string

---

## <a name="symbols"></a> üìà Symbols

Retrieve available trading symbols and configurations.

### `GET /symbols`
Get a list of all available symbols.
- **Response:** Array of symbol strings (e.g., `["EURUSD", "GBPUSD"]`).

### `GET /symbol-config`
Get enabled symbols from the configuration. This is used by the trading terminal to know which symbols to trade.
- **Response:** Array of enabled symbol strings.

### `DELETE /admin/symbolconfig/delete/`
Delete a symbol configuration (Admin only).
- **Query Params:**
  - `id` (Required): ID of the symbol config to delete.

---

## <a name="trades"></a> üîÑ Trades

Manage and retrieve trade history and active positions.

### `GET /trades`
Get a list of trades.
- **Query Params:**
  - `state`: Filter by trade state ('open' or 'history').
  - `account_number`: Filter by specific account.
- **Response:** Array of trade objects.

### `POST /trades`
Create or update a single trade.
- **Body:**
  - `ticket` (Required): int - MT5 ticket number
  - `account_number`: string
  - `symbol`: string
  - `type`: int (0=Buy, 1=Sell)
  - `volume`: float
  - `open_price`: float
  - `open_time`: string (YYYY-MM-DD HH:MM:SS)
  - ... other trade fields

### `POST /trades/batch`
Batch create or update trades for better performance.
- **Body:**
  - `trades`: Array of trade objects.

### `PUT /trades/<id>`
Update a specific trade by its internal DB ID.
- **Path Params:** `id` (Internal Database ID)
- **Body:** Key-value pairs of fields to update.

### `POST /trades/<id>/rating`
Update the user rating for a specific trade.
- **Path Params:** `id` (Internal Database ID)
- **Body:**
  - `rating`: int (0-5)

---

## <a name="candles"></a> üïØÔ∏è Candles

Historical market data management.

### `GET /candles`
Retrieve historical candle data.
- **Query Params:**
  - `symbol` (Default: EURUSD)
  - `timeframe` (Default: H1)
  - `limit`: Number of candles to return (Default: 200)
  - `before`: Timestamp to load candles before (for pagination).
- **Response:** Array of candle objects.

### `GET /candles/last`
Get the timestamp of the last recorded candle. Used for synchronization.
- **Query Params:**
  - `symbol` (Required)
  - `timeframe` (Required)
- **Response:** `{ "timestamp": "...", "exists": boolean }`

### `POST /candles`
Bulk add or update candles.
- **Body:**
  - `symbol`: string
  - `timeframe`: string
  - `candles`: Array of candle objects (`timestamp`, `open`, `high`, `low`, `close`, `volume`).

---

## <a name="announcements"></a> üì¢ Announcements

Economic calendar announcements.

### `GET /announcements`
Get economic announcements.
- **Query Params:**
  - `status`: 'pending' (default), 'all', or 'processed'.
  - `search`: Filter by text or symbol.
  - `page`: Page number.
  - `per_page`: Items per page.
  - `filter_type`: 'all', 'buy', 'sell' (for processed).

---

## <a name="trade-notes"></a> üìù Trade Notes

User notes attached to trades.

### `GET /trade-notes`
Get trade notes.
- **Query Params:**
  - `trade_ticket`: Filter by specific trade ticket.

### `POST /trade-notes`
Create a new note for a trade.
- **Body:**
  - `trade_ticket` (Required)
  - `note_content` (Required)
  - `note_title` (Optional)

### `DELETE /trade-notes/<id>`
Delete a specific trade note.

---

## <a name="trading-signals"></a> üö¶ Trading Signals

Signals generated by the AI or external sources.

### `GET /trading-signals`
Get a list of trading signals.
- **Query Params:**
  - `status`: Filter by status (e.g., 'new', 'executed').

### `POST /trading-signals/<signal_id>/update`
Update the status of a trading signal.
- **Path Params:** `signal_id` (UUID or DB ID)
- **Body:**
  - `status`: New status string.
  - `trade_ticket`: Optional ticket number if executed.

---

## <a name="system-logs"></a> üñ•Ô∏è System Logs

Access server logs and diagnostics.

### `GET /system-logs`
Get basic system logs.
- **Query Params:**
  - `level`: Filter by log level.
  - `limit`: Max logs to return.

### `GET /logs/enhanced`
Get logs with advanced filtering options.
- **Query Params:**
  - `level`, `module`, `limit`

### `GET /logs/stats`
Get statistics about log distribution (counts per level, module).

### `GET /logs/errors`
Get a summary of recent errors and critical alerts.

### `POST /logs/cleanup`
Delete old logs to free up space.
- **Body:**
  - `days`: int (Delete logs older than X days, default 30).

---

## <a name="ai-responses"></a> ü§ñ AI Responses

History of AI analyses and decisions.

### `GET /ai-responses`
Get AI analysis records.
- **Query Params:**
  - `announcement_id`: Filter by specific announcement.

---

## <a name="statistics"></a> üìä Statistics

Aggregated performance metrics.

### `GET /full-stats`
Get comprehensive statistics for the dashboard, including:
- Capital history chart data.
- Risk management metrics (Win rate, Drawdown, Profit Factor).
- Portfolio exposure distribution.
- AI signal distribution (Buy/Sell/Hold).

---

## <a name="telegram"></a> üì± Telegram

Telegram bot integration endpoints.

### `GET /telegram/users`
Get a list of configured Telegram users and admins.

### `POST /telegram/send`
Send a custom message to specific users.
- **Body:**
  - `recipients`: Array of user IDs.
  - `message`: Text content.
  - `image_url`: Optional image path.
  - `parse_mode`: 'HTML' or 'Markdown'.

### `POST /telegram/upload-image`
Upload an image to be sent via Telegram.
- **Form Data:**
  - `image`: File object.
- **Response:** `url` relative path to the uploaded image.
